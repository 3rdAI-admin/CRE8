# Pre-commit Hooks for Context Engineering Template

This repository includes pre-commit hooks to automatically validate code quality before commits.

## Installation

### 1. Install pre-commit

```bash
# Using pip
pip install pre-commit

# Using uv
uv add --dev pre-commit

# Using homebrew (macOS)
brew install pre-commit
```

### 2. Install the git hooks

```bash
# Run from repository root
pre-commit install

# Also install for commit messages
pre-commit install --hook-type commit-msg
```

## What Gets Checked

### General
- Trailing whitespace
- End of file fixing
- YAML syntax
- JSON syntax (excluding JSONC files like tsconfig.json)
- Large files detection
- Merge conflict markers
- Case conflicts

### Python (PydanticAI & Agent Factory)
- **Ruff linting**: Catches common errors and code smells
- **Ruff formatting**: Ensures consistent code style
- Runs only on files in `use-cases/pydantic-ai/` and `use-cases/agent-factory-with-subagents/`

### Shell Scripts
- **Shellcheck**: Validates bash scripts for common issues
- Checks all `*.sh` files

### Markdown
- **Markdownlint**: Validates markdown formatting
- Auto-fixes common issues
- Relaxed rules for line length and HTML

### TypeScript/JavaScript (MCP Server)
- **Prettier**: Formats TypeScript/JavaScript code
- Runs only on files in `use-cases/mcp-server/`

### Custom Checks
- README mentions all commands
- Setup scripts are executable
- JSON validation (with JSONC support)

## Usage

### Automatic (on commit)
Once installed, hooks run automatically when you commit:

```bash
git add .
git commit -m "feat: add new feature"
# Hooks run automatically and may modify files
# If changes were made, commit again to include fixes
```

### Manual (check all files)
```bash
# Run all hooks on all files
pre-commit run --all-files

# Run specific hook
pre-commit run ruff --all-files
pre-commit run shellcheck --all-files
```

### Manual (check staged files)
```bash
# Run hooks only on staged files
pre-commit run
```

### Skip hooks (when needed)
```bash
# Skip all hooks
git commit -m "message" --no-verify

# Skip specific hooks (use SKIP environment variable)
SKIP=ruff,shellcheck git commit -m "message"
```

## Troubleshooting

### "command not found" errors

Some hooks require additional tools:

```bash
# Install ruff (Python)
pip install ruff
# or
uv add --dev ruff

# Install shellcheck
# macOS
brew install shellcheck
# Linux
sudo apt-get install shellcheck

# Install markdownlint
npm install -g markdownlint-cli

# Install prettier
npm install -g prettier
```

### Hooks not running

```bash
# Reinstall hooks
pre-commit uninstall
pre-commit install
pre-commit install --hook-type commit-msg

# Update to latest hook versions
pre-commit autoupdate
```

### False positives

If a hook incorrectly flags a file:

1. **Temporary skip**: Use `--no-verify` flag
2. **Exclude file**: Add to `.pre-commit-config.yaml` exclude section
3. **Disable specific check**: Modify args in `.pre-commit-config.yaml`

### JSONC files flagged as invalid JSON

The config excludes `tsconfig.json` and `.vscode/settings.json` from JSON validation since they support comments (JSONC format).

## Configuration

Edit `.pre-commit-config.yaml` to:
- Update hook versions: `pre-commit autoupdate`
- Add new hooks
- Exclude files or directories
- Modify hook arguments

## Best Practices

1. **Install early**: Set up pre-commit when you clone the repository
2. **Run before commits**: Always run `pre-commit run` before committing if you've made many changes
3. **Keep updated**: Run `pre-commit autoupdate` periodically
4. **Don't skip unnecessarily**: Hooks catch real issues - fix them instead of skipping
5. **Add to CI**: Use the same hooks in CI/CD (see `.github/workflows/validate.yml`)

## Integration with /validate-project Command

Pre-commit hooks complement the **`/validate-project`** command (generated by `/generate-validate`):

| Tool | When | What |
|------|------|------|
| Pre-commit | Before commit | Fast, file-level checks |
| /validate-project | After changes | Comprehensive, project-level validation (from /generate-validate) |

Use both for best results:
1. Pre-commit catches issues as you code
2. **`/validate-project`** ensures everything works together (use this, not `/validate`, for project validation)
